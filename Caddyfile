# Désactive HTTP/3 (pour éviter les H3_REQUEST_CANCELLED)
{
  experimental_http3 off
}

# Domaine principal
fastapi-twilio.rockballsmedia.eu {
  # Tout le trafic HTTP/HTTPS sur Uvicorn
  reverse_proxy /* localhost:5000

  # WebSocket pour /media-stream
  @ws {
    path /media-stream*
  }
  reverse_proxy @ws localhost:5000 {
    transport http {
      versions 1.1
    }
  }

  # Let's Encrypt automatique
  tls rockballsmedia@gmail.com
}
